<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FullTeam - Venues</title>
<link rel="stylesheet" href="style.css" />

</head>

<body>

<header>
  <div class="header-inner">
    <h1 class="header-title" aria-label="Logo FullTeam">FullTeam</h1>
    <div class="menu-buttons">
    <button class="btn-menu active" type="button" onclick="setActiveMenu(this)">Sewa Lapangan</button>
    <button class="btn-menu" type="button" onclick="setActiveMenu(this)">Main Bareng</button>
  </div>
    <form class="search-form" id="searchForm" onsubmit="return false;" role="search" aria-label="Search venues">
      <input
        type="search"
        id="searchInput"
        placeholder="Cari venue"
        autocomplete="off"
        aria-label="Cari venue"
        id="searchInput"
      />
      <button type="submit" class="search-btn" aria-label="Search" onclick="filterVenuesEvent()">üîç</button>
    </form>
   <div class="auth-buttons">
  <button class="btn-masuk" type="button">Masuk</button>
  <button class="btn-daftar" type="button">Daftar</button>
  <button class="btn-profile" type="button" style="display:none;">
  <img src="https://img.icons8.com/ios/40/000000/user-male-circle--v2.png" alt="Profil" style="width:28px;height:28px;border-radius:50%;" />
</button>
      <div class="profile-dropdown" id="profileDropdown" style="display:none;">
    <button type="button" class="dropdown-item" id="btnProfile">Profile</button>
    <button type="button" class="dropdown-item" id="btnDashboard">Dashboard</button>
    <button type="button" class="dropdown-item" id="btnLogout">Logout</button>
      </div>
    </div>
  </div>
</header>

<!-- Halaman Data Diri User -->
<div id="profilePage" style="display:none; max-width:500px; margin:40px auto; background:#fff; border-radius:12px; box-shadow:0 2px 16px rgba(0,0,0,0.08); padding:32px;">
  <h2>Profile</h2>
  <form id="editProfileForm">
    <div style="margin-bottom:18px;">
      <label>Nama Lengkap <span style="color:red">*</span></label><br>
      <input type="text" id="editNama" name="nama" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
    </div>
    <div style="margin-bottom:18px;">
      <label>Username <span style="color:red">*</span></label><br>
      <input type="text" id="editUsername" name="username" required style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
    </div>
    <div style="margin-bottom:18px;">
      <label>Nomor Ponsel</label><br>
      <input type="text" id="editPonsel" name="ponsel" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;">
    </div>
    <div style="margin-bottom:18px;">
      <label>Email</label><br>
      <input type="email" id="editEmail" name="email" readonly style="width:100%;padding:8px;border-radius:6px;border:1px solid #eee;background:#f7f7f7;">
    </div>
    <div style="display: flex; margin-top: 24px;">
    <button type="button" id="btnGoBackProfile" style="background: #fff; color: #222; border:1px solid #bbb; border-radius:6px; padding:10px 24px;">Kembali</button>
    <button type="submit" style="padding:10px 24px;border-radius:6px;background:#2563eb;color:#fff;border:none; margin-left: auto;">Simpan Perubahan</button>
    </div>
  </form>
</div>

<!-- Dashboard Main Bareng -->
<div id="dashboardPage" style="display:none;max-width:700px;margin:40px auto;padding:32px 24px;background:#fff;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.06);">
  <h2 style="font-size:1.6rem;font-weight:600;margin-bottom:24px;">Dashboard</h2>
  <div style="display:flex;gap:32px;margin-bottom:24px;">
    <div style="font-weight:500;padding-bottom:4px;border-bottom:2px solid #d32f2f;color:#d32f2f;cursor:pointer;">Main Bareng</div>
  </div>
  <div style="display:flex;gap:12px;margin-bottom:20px;">
    <input type="text" placeholder="Cari mabar disini" style="flex:1;padding:10px 14px;border:1px solid #ddd;border-radius:6px;">
    <select style="padding:10px 14px;border:1px solid #ddd;border-radius:6px;">
      <option>Semua Cabor</option>
    </select>
    <input type="text" placeholder="Tanggal main" style="padding:10px 14px;border:1px solid #ddd;border-radius:6px;width:140px;">
  </div>
  <div style="display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;">
    <button style="background:#b71c1c;color:#fff;border:none;padding:8px 18px;border-radius:6px;font-weight:500;">Semua Status</button>
    <button style="background:#f5f5f5;color:#333;border:none;padding:8px 18px;border-radius:6px;">Menunggu Pembayaran</button>
    <button style="background:#f5f5f5;color:#333;border:none;padding:8px 18px;border-radius:6px;">Bergabung</button>
    <button style="background:#f5f5f5;color:#333;border:none;padding:8px 18px;border-radius:6px;">Dibatalkan</button>
    <button style="background:#f5f5f5;color:#333;border:none;padding:8px 18px;border-radius:6px;">Selesai</button>
  </div>
  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:60px;">
    <img src="https://img.icons8.com/ios/100/cccccc/document--v1.png" width="80" alt="empty" style="margin-bottom:18px;opacity:0.5;">
    <div style="font-weight:600;font-size:1.1rem;margin-bottom:8px;">Belum ada Main bareng</div>
    <div style="color:#888;">Main bareng yang kamu buat atau ikuti akan muncul disini, ya.</div>
  </div>
</div>

<div id="authModal" class="auth-modal" style="display:none;">
  <div class="auth-modal-content">
    <span class="auth-modal-close" id="authModalClose">&times;</span>
    <div id="authModalBody"></div>
  </div>
</div>

<main>
  <!-- Section untuk Venue -->
  <section id="venueSection">
    <div class="venue-header-row">
      <h2 class="section-title" id="venueTitle">Venue</h2>
      <div class="autocomplete-location">
        <input type="text" id="locationAutocomplete" placeholder="Cari lokasi" autocomplete="off" />
        <ul id="locationSuggestions" class="suggestions-list"></ul>
      </div>
    </div>
    <div class="venues-grid" id="venuesGrid" aria-live="polite" aria-relevant="additions removals">
      <!-- Venue cards will be dynamically inserted here -->
    </div>
    <div id="venueDetailContainer"></div>
    <nav class="pagination" aria-label="Pagination venues" id="paginationNav">
      <!-- Pagination buttons inserted here -->
    </nav>
  </section>

  <!-- Section untuk Main Bareng -->
  <section id="mainBarengSection" style="display:none;">
    <h2 class="section-title" id="mainbarengTitle">Main Bareng</h2>
    <button class="btn-create-event" id="btnShowModal">+ Buat Event Main Bareng</button>
    <div id="mainbarengGrid" class="mainbareng-grid"></div>
    <div id="mainbarengDetailContainer" style="display:none;"></div>
  </section>
</main>

  <div class="modal-overlay" id="modalCreateMabar" style="display:none;">
    <div class="modal-content">
      <button class="modal-close" id="btnCloseModal" title="Tutup">&times;</button>
      <form class="mainbareng-form" id="formCreateMabar" autocomplete="off">
        <label>Judul Event
          <input type="text" name="title" required />
        </label>
        <label>Olahraga
          <input type="text" name="sport" required />
        </label>
        <label>Level
          <select name="level" required>
            <option value="Santai">Santai</option>
            <option value="Kompetitif">Kompetitif</option>
          </select>
        </label>
        <label>Tanggal & Waktu
          <input type="datetime-local" name="datetime" required />
        </label>
        <label>Lokasi
          <textarea name="location" required></textarea>
        </label>
        <label>Kuota
          <input type="number" name="quota" min="2" max="50" required />
        </label>
        <label> Metode Pembayaran
          <select name="paymentMethod" required>
            <option value="Online & Tunai">Online & Tunai</option>
            <option value="Online">Online</option>
          </select>
        </label>
        <div class="form-actions">
          <button type="submit" class="btn-create-event">Buat Event</button>
          <button type="button" class="btn-cancel" id="btnCancelModal">Batal</button>
        </div>
      </form>
    </div>
  </div>

<!-- Modal Booking -->
<div id="bookingModal" style="display:none;">
  <div class ="modal-content">
    <h3>Pilih Jadwal Lapangan</h3>
    <input type="date" id="bookingDate" style="margin-bottom:12px;" />
    <div id="scheduleSlots"></div>
    <button onclick="closeBookingModal()">Tutup</button>
  </div>
</div>

<!-- Modal Booking Berhasil -->
<div id="bookingSuccessModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);align-items:center;justify-content:center;">
  <div style="background:#fff;padding:32px 24px;border-radius:12px;box-shadow:0 2px 16px rgba(0,0,0,0.12);text-align:center;max-width:320px;">
    <h3>Booking Berhasil!</h3>
    <p>Booking lapangan kamu sudah tercatat.</p>
    <button id="btnBookingOk" style="margin-top:18px;padding:10px 32px;border-radius:6px;background:#2563eb;color:#fff;border:none;">OK</button>
  </div>
</div>

<div id="notifLogin" style="display:none;position:fixed;top:40px;left:50%;transform:translateX(-50%);background:#fff3cd;color:#856404;padding:18px 32px;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.18);z-index:10001;font-size:1.1rem;">
  <span>Anda harus login terlebih dahulu sebelum melakukan booking.</span>
  <button id="notifLoginClose" style="margin-left:24px;background:#ffe8a1;border:none;padding:6px 18px;border-radius:6px;cursor:pointer;">Tutup</button>
</div>

<footer>
  &copy; 2025 FullTeam - Venues Listing. All rights reserved.
</footer>

<script>
  // modal pop up
  function showAuthModal(type) {
  const modal = document.getElementById('authModal');
  const body = document.getElementById('authModalBody');
  if (type === 'login') {
    body.innerHTML = `
      <h2>Masuk</h2>
      <form id="loginForm" autocomplete="off">
        <input type="email" placeholder="Email" required />
        <input type="password" placeholder="Password" required />
        <button type="submit">Masuk</button>
        <div class="auth-switch">
          Belum punya akun? <a onclick="showAuthModal('register')">Daftar</a><br>
          <a onclick="showAuthModal('forgot')">Lupa password?</a>
        </div>
      </form>
    `;
  } else if (type === 'register') {
    body.innerHTML = `
      <h2>Daftar</h2>
      <form id="registerForm" autocomplete="off">
        <input type="email" placeholder="Email" required />
        <input type="password" placeholder="Password" required />
        <input type="password" placeholder="Ulangi Password" required />
        <button type="submit">Daftar</button>
        <div class="auth-switch">
          Sudah punya akun? <a onclick="showAuthModal('login')">Masuk</a>
        </div>
      </form>
    `;
  } else if (type === 'forgot') {
    body.innerHTML = `
      <h2>Lupa Password</h2>
      <form id="forgotForm" autocomplete="off">
        <input type="email" placeholder="Email" required />
        <button type="submit">Kirim</button>
        <div class="auth-switch">
          <a onclick="showAuthModal('login')">Kembali ke Masuk</a>
        </div>
      </form>
    `;
  }
  modal.style.display = 'flex';
}

// register user ke database
document.addEventListener('submit', function(e) {
  if (e.target && e.target.id === 'registerForm') {
    e.preventDefault();
    const email = e.target.querySelector('input[type="email"]').value.trim().toLowerCase();
    const password = e.target.querySelectorAll('input[type="password"]')[0].value;
    const password2 = e.target.querySelectorAll('input[type="password"]')[1].value;

    if (password !== password2) {
      alert('Password tidak sama!');
      return;
    }

    // Kirim data ke backend (MySQL)
    fetch('http://localhost:3000/api/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ email, password })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        alert('Pendaftaran berhasil! Silakan login.');
        showAuthModal('login');
      } else {
        alert(data.message || 'Pendaftaran gagal!');
      }
    })
    .catch(() => alert('Terjadi kesalahan, coba lagi.'));
  }
});

// validasi login
document.addEventListener('submit', function(e) {
  if (e.target && e.target.id === 'loginForm') {
    e.preventDefault();
    const email = e.target.querySelector('input[type="email"]').value.trim().toLowerCase();
    const password = e.target.querySelector('input[type="password"]').value;

    fetch('http://localhost:3000/api/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ email, password })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('userEmail', data.user.email);
        updateAuthUI();
        document.getElementById('authModal').style.display = 'none';
      } else {
        alert('Email atau password salah!');
      }
    });
  }
});

function isLoggedIn() {
  return localStorage.getItem('isLoggedIn') === 'true';
}

// Tutup modal
document.getElementById('authModalClose').onclick = function() {
  document.getElementById('authModal').style.display = 'none';
};
window.addEventListener('click', function(e) {
  const modal = document.getElementById('authModal');
  if (e.target === modal) modal.style.display = 'none';
});

// Event tombol header
document.querySelector('.btn-masuk').onclick = () => showAuthModal('login');
document.querySelector('.btn-daftar').onclick = () => showAuthModal('register');

// Event untuk menampilkan form login, forgot password, dan register
  function showLogin(e) {
  e.preventDefault();
  document.getElementById('form-login').style.display = '';
  document.getElementById('form-forgot').style.display = 'none';
  document.getElementById('form-register').style.display = 'none';
}
function showForgot(e) {
  e.preventDefault();
  document.getElementById('form-login').style.display = 'none';
  document.getElementById('form-forgot').style.display = '';
  document.getElementById('form-register').style.display = 'none';
}
function showRegister(e) {
  e.preventDefault();
  document.getElementById('form-login').style.display = 'none';
  document.getElementById('form-forgot').style.display = 'none';
  document.getElementById('form-register').style.display = '';
}

// Update UI based on login state
function updateAuthUI() {
  const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
  document.querySelector('.btn-masuk').style.display = isLoggedIn ? 'none' : '';
  document.querySelector('.btn-daftar').style.display = isLoggedIn ? 'none' : '';
  document.querySelector('.btn-profile').style.display = isLoggedIn ? '' : 'none';
  document.getElementById('profileDropdown').style.display = 'none';
}

// Panggil fungsi ini setelah login/logout dan saat halaman dimuat
updateAuthUI();

document.querySelector('.btn-profile').onclick = function() {
  if (confirm('Logout?')) {
    localStorage.removeItem('isLoggedIn');
    updateAuthUI();
  }
};

const btnProfile = document.querySelector('.btn-profile');
const dropdown = document.getElementById('profileDropdown');

// Toggle dropdown saat klik ikon profil
btnProfile.onclick = function(e) {
  e.stopPropagation();
  dropdown.style.display = dropdown.style.display === 'none' ? 'flex' : 'none';
};

// Tutup dropdown jika klik di luar
document.addEventListener('click', function(e) {
  if (!dropdown.contains(e.target) && e.target !== btnProfile) {
    dropdown.style.display = 'none';
  }
});

// Logout
document.getElementById('btnLogout').onclick = function() {
  localStorage.removeItem('isLoggedIn');
  localStorage.removeItem('userEmail');
  dropdown.style.display = 'none';
  updateAuthUI();
};

// Profile
document.getElementById('btnProfile').onclick = function() {
  document.getElementById('profilePage').style.display = '';
  document.querySelector('main').style.display = 'none';
  document.getElementById('venuesGrid').style.display = 'none';
  document.getElementById('mainbarengGrid').style.display = 'none';
  document.getElementById('venueDetailContainer').innerHTML = '';

  // Ambil email user dari localStorage (atau session/cookie)
  const email = localStorage.getItem('userEmail');
  if (!email) {
    alert('User tidak ditemukan!');
    return;
  }

  fetch('http://localhost:3000/api/profile', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ email })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById('editNama').value = data.user.nama || '';
      document.getElementById('editUsername').value = data.user.username || '';
      document.getElementById('editPonsel').value = data.user.ponsel || '';
      document.getElementById('editEmail').value = data.user.email || '';
    } else {
      alert('Gagal mengambil data diri');
    }
  });
};

// Prefill data user ke form
function showEditProfile(user) {
  document.getElementById('editNama').value = user.nama || '';
  document.getElementById('editUsername').value = user.username || '';
  document.getElementById('editPonsel').value = user.ponsel || '';
  document.getElementById('editEmail').value = user.email || '';
  document.getElementById('editProfileForm').style.display = '';
}

// Submit perubahan data diri
document.getElementById('editProfileForm').onsubmit = function(e) {
  e.preventDefault();
  const data = {
    nama: document.getElementById('editNama').value,
    username: document.getElementById('editUsername').value,
    ponsel: document.getElementById('editPonsel').value,
    email: document.getElementById('editEmail').value
  };
  fetch('http://localhost:3000/api/profile/update', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    alert(res.success ? 'Data berhasil diubah!' : (res.message || 'Gagal mengubah data'));
  });
};

document.getElementById('btnGoBackProfile').onclick = function() {
  document.getElementById('profilePage').style.display = 'none';
  // Tampilkan kembali halaman utama
  document.querySelector('main').style.display = '';
  document.getElementById('venuesGrid').style.display = '';
  // Atur tampilan lain sesuai kebutuhan
};

document.getElementById('btnDashboard').onclick = function() {
  document.getElementById('dashboardPage').style.display = '';
  document.getElementById('profilePage').style.display = 'none';
  document.querySelector('main').style.display = 'none';
  document.getElementById('venuesGrid').style.display = 'none';
  document.getElementById('venueDetailContainer').innerHTML = '';
  document.getElementById('mainbarengGrid').style.display = 'none';
  document.getElementById('mainbarengTitle').style.display = 'none';
  dropdown.style.display = 'none';
};




  // Venue data
  let venuesData = [];

  function loadVenuesFromAPI() {
    fetch('http://localhost:3000/api/venues')
    .then(res => res.json())
    .then(data => {
      venuesData = data;
      console.log(venuesData)
      renderVenues();
    })  
    .catch(err => {
      console.error('Gagal mengambil data venue:', err);
    });
  }

  loadVenuesFromAPI();

  // Main Bareng data
  const mainbarengData = [
  {
    id: 2,
    title: "Mabar Selasa Malam",
    sport: "Badminton",
    level: "Newbie - Pro",
    datetime: "Sel, 03 Jun 2025, 19:00 - 22:00",
    location: "Lapangan D - Bulu Bulu Badminton, Kota Tangerang Selatan",
    bookedVia: true,
    superhost: true,
    participants: [
      { name: "A", avatar: "https://randomuser.me/api/portraits/men/1.jpg" },
      { name: "T", avatar: "https://randomuser.me/api/portraits/women/2.jpg" }
    ],
    quota: "14/15",
    host: {
      name: "Sobat Kalong",
      rating: 4.93,
      count: 17
      }
    }, 
  ];

  let lastVenueSearch = '';
  let activeCategory = 'all';
  let activeLocation = 'all';
  let currentPage = 1;
  const venuesPerPage = 6;

  // Render venue cards
  function createVenueCard(venue) {
    const article = document.createElement('article');
    article.className = 'venue-card';
    article.setAttribute('data-category', venue.category);
    article.setAttribute('data-location', venue.location);

    const img = document.createElement('img');
    img.className = 'venue-img';
    img.src = venue.image;
    img.alt = venue.title;

    const infoDiv = document.createElement('div');
    infoDiv.className = 'venue-info';

    const title = document.createElement('h3');
    title.className = 'venue-title';
    title.textContent = venue.title;

    const locationP = document.createElement('p');
    locationP.className = 'venue-location';
    locationP.textContent = capitalizeWords(venue.location);

    // Rating stars
    const ratingDiv = document.createElement('div');
    ratingDiv.className = 'rating';
    ratingDiv.setAttribute('aria-label', `Rating ${venue.rating} dari 5`);
    const fullStars = Math.floor(venue.rating);
    const halfStar = venue.rating - fullStars >= 0.5;
    for (let i = 1; i <= 5; i++) {
      const starSpan = document.createElement('span');
      if (i <= fullStars) {
        starSpan.textContent = '‚òÖ';
        starSpan.style.color = '#ffc107';
      } else if (i === fullStars + 1 && halfStar) {
        starSpan.textContent = '‚òÜ'; // half star substitute
        starSpan.style.color = '#ffc107';
      } else {
        starSpan.textContent = '‚òÜ';
        starSpan.style.color = '#ddd';
      }
      ratingDiv.appendChild(starSpan);
    }
    const ratingValue = document.createElement('div');
    ratingValue.className = 'rating-value';
    ratingValue.textContent = venue.rating.toFixed(1);
    ratingDiv.appendChild(ratingValue);

    // Meta info: price and capacity
    const metaDiv = document.createElement('div');
    metaDiv.className = 'venue-meta';

    const priceSpan = document.createElement('span');
    priceSpan.textContent = venue.price;

    const capacitySpan = document.createElement('span');
    capacitySpan.textContent = `Capacity: ${venue.capacity}`;

    metaDiv.appendChild(priceSpan);
    metaDiv.appendChild(capacitySpan);

    // Availability badge
    const availSpan = document.createElement('span');
    availSpan.className = 'availability ' + (venue.availability ? 'available' : 'unavailable');
    availSpan.textContent = venue.availability ? 'Available' : 'Unavailable';
    availSpan.setAttribute('aria-label', venue.availability ? 'Tersedia' : 'Tidak tersedia');

    // Description
    const descP = document.createElement('p');
    descP.className = 'venue-description';
    descP.textContent = venue.description;

    infoDiv.appendChild(title);
    infoDiv.appendChild(locationP);
    infoDiv.appendChild(ratingDiv);
    infoDiv.appendChild(metaDiv);
    infoDiv.appendChild(availSpan);
    infoDiv.appendChild(descP);

    article.appendChild(img);
    article.appendChild(infoDiv);

    article.addEventListener('click', () => {
      showVenueDetail(venue);
    });

    return article;
  }

  // Render initial venues
  function showVenueDetail(venue) {
  document.querySelector('.venue-header-row').style.display = 'none';
  document.getElementById('venuesGrid').style.display = 'none';
  document.getElementById('paginationNav').style.display = 'none';

  const container = document.getElementById('venueDetailContainer');
  container.innerHTML = `
    <div class="venue-detail-page">
      <h1>${venue.title}</h1>
      <div class="venue-detail-meta">
        <span>‚≠ê ${venue.rating ?? '-'} &nbsp;‚Ä¢&nbsp; ${venue.location}</span>
      </div>
      <img src="${venue.image}" alt="${venue.title}" class="venue-detail-img">
      <hr>
      <h3>Deskripsi</h3>
      <p>${venue.description ?? '-'}</p>
      <h3>Aturan Venue</h3>
      <ol>
        <li>Pelanggan harus datang tepat waktu.</li>
        <li>Dilarang membawa air mineral gelas.</li>
        <li>Dilarang bersandar dijaring.</li>
        <li>Dilarang membawa senjata tajam dan minuman keras.</li>
        <li>Dilarang memakai sepatu berdempul.</li>
      </ol>
      <h3>Lokasi Venue</h3>
      <div class="venue-detail-location">
        Pd Pasar Jaya Pasar Baru Metro Atom Plaza Lt. 8 (Gedung Parkir) Jakarta Pusat
      </div>
      <h3>Fasilitas</h3>
      <ul class="venue-detail-facilities">
        <li>üçΩÔ∏è Cafe & Resto</li>
        <li>üçî Jual Makanan Ringan</li>
        <li>ü•§ Jual Minuman</li>
        <li>üïå Musholla</li>
        <li>üöó Parkir Mobil</li>
        <li>üèçÔ∏è Parkir Motor</li>
      </ul>
      <h3>Jadwal Lapangan</h3>
      <button onclick="openBookingModal(${venue.id})" class="btn-cek-jadwal">Cek Jadwal Tersedia</button>
      <button class="btn-kembali" onclick="backToVenueList()">Kembali ke daftar venue</button>
    </div>
  `;
}

let selectedVenueId = null;

// Open booking modal
function openBookingModal(venueId) {
  selectedVenueId = venueId;
  document.getElementById('bookingModal').style.display = 'block';
  document.body.style.overflow = 'hidden'; // Disable body scroll
  // Tampilkan semua jadwal
  let html = '';
  jadwalLapangan.forEach(jadwal => {
    html += `
      <div class="jadwal-card">
        <div class="jadwal-waktu"><b>${jadwal.start} - ${jadwal.end}</b></div>
        <div class="jadwal-harga">${jadwal.price}</div>
        <button class="btn-booking">Booking</button>
      </div>
    `;
  });
  document.getElementById('scheduleSlots').innerHTML = html;
}

document.getElementById('scheduleSlots').onclick = function(e) {
  if (e.target.classList.contains('btn-booking')) {
    if (!isLoggedIn()) {
      document.getElementById('notifLogin').style.display = 'block';
      return;
    }
    const card = e.target.closest('.jadwal-card');
    const time = card.querySelector('.jadwal-waktu').innerText;
    const venueId = selectedVenueId;
    const date = document.getElementById('bookingDate').value;

    if (!date) {
      alert('Silakan pilih tanggal terlebih dahulu.');
      return;
    }

    // Kirim booking ke backend
    fetch('http://localhost:3000/api/booking', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        venueId: venueId,
        date: date,
        time: time,
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById('bookingSuccessModal').style.display = 'flex';
        document.getElementById('bookingModal').style.display = 'none';
        document.body.style.overflow = '';
      } else {
        alert(data.message || 'Booking gagal');
      }
    })
    .catch(() => {
      alert('Terjadi kesalahan saat booking.');
    });
  }
};

document.getElementById('notifLoginClose').onclick = function() {
  document.getElementById('notifLogin').style.display = 'none';
  showAuthModal('login');
};

function closeBookingModal() {
  document.getElementById('bookingModal').style.display = 'none';
  document.body.style.overflow = ''; // Enable body scroll
}

// Function to load schedule for selected venue
function loadSchedule() {
  const date = document.getElementById('bookingDate').value;
  if (!date) return;
  fetch(`http://localhost:3000/api/schedule?venueId=${selectedVenueId}&date=${date}`)
    .then(res => res.json())
    .then(slots => {
      // slots = [{time: "07:00-08:00", booked: false}, ...]
      let html = '';
      slots.forEach(slot => {
        html += `<button ${slot.booked ? 'disabled' : ''} onclick="bookSlot('${slot.time}')">
          ${slot.time} ${slot.booked ? '(Booked)' : ''}
        </button>`;
      });
      document.getElementById('scheduleSlots').innerHTML = html;
    });
}

document.getElementById('btnBookingOk').onclick = function() {
  document.getElementById('bookingSuccessModal').style.display = 'none';
  document.getElementById('profilePage').style.display = 'none';
  document.querySelector('main').style.display = '';
  backToVenueList();
};

// Function to go back to the venue list
function backToVenueList() {
  document.getElementById('venueDetailContainer').innerHTML = '';
  document.getElementById('venuesGrid').style.display = '';
  document.getElementById('paginationNav').style.display = '';
  document.querySelector('.venue-header-row').style.display = '';
  document.getElementById('mainbarengGrid').style.display = 'none';
  document.getElementById('mainbarengTitle').style.display = 'none';
  closeBookingModal();
}

document.querySelectorAll('.btn-menu').forEach(btn => {
  btn.addEventListener('click', function() {
    document.getElementById('profilePage').style.display = 'none';
    document.getElementById('dashboardPage').style.display = 'none';
    document.querySelector('main').style.display = '';
    setActiveMenu(this);

    if (this.textContent.trim() === 'Sewa Lapangan') {
      backToVenueList();
    }
    if (this.textContent.trim() === 'Main Bareng') {
      backToMainBarengList();
      fetchAndRenderMainBareng();
    }
  });
});

  async function fetchAndRenderMainBareng() {
  const res = await fetch('http://localhost:3000/api/mainbareng');
  const result = await res.json();
  const grid = document.getElementById('mainbarengGrid');
  grid.innerHTML = '';
  if (!result.success || !result.data || result.data.length === 0) {
    grid.innerHTML = '<p>Tidak ada event main bareng.</p>';
    return;
  }
  result.data.forEach(item => {
    grid.innerHTML += `
    <div class="mainbareng-card" data-id="${item.id}">
        <div class="mainbareng-header">
          <strong>${item.title}</strong>
          <div class="mainbareng-meta">${item.sport} &bull; ${item.level}</div>
        </div>
        <div class="mainbareng-time">
          <b>Tanggal:</b> ${new Date(item.datetime).toLocaleDateString('id-ID', {weekday:'short', day:'2-digit', month:'short', year:'numeric'})}
          <br>
          <b>Jam:</b> ${new Date(item.datetime).toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'})}
        </div>
        <div class="mainbareng-location"><b>Lokasi:</b> ${item.location}</div>
        <div class="mainbareng-badges">
          <span class="badge booked">${item.quota} orang</span>
        </div>
        <div class="mainbareng-host">
          Host: <b>${item.host_name || '-'}</b>
        </div>
      </div>
    `;
  });

  document.querySelectorAll('.mainbareng-card').forEach(card => {
    card.addEventListener('click', function(e) {
      if (e.target.classList.contains('btn-create-event')) return;
      const id = this.getAttribute('data-id');
      if (!id) return;
      showMainBarengDetail(id);
    });
  });
}

function renderMainBarengList(list) {
  const container = document.getElementById('mainbarengGrid');
  container.innerHTML = '';

  if (!list.length) {
    container.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:40px;">
        <img src="https://img.icons8.com/ios/100/cccccc/document--v1.png" width="80" alt="empty" style="margin-bottom:18px;opacity:0.5;">
        <div style="font-weight:600;font-size:1.1rem;margin-bottom:8px;">Belum ada Main bareng</div>
        <div style="color:#888;">Main bareng yang kamu buat atau ikuti akan muncul disini, ya.</div>
      </div>
    `;
    return;
  }

  list.forEach(mabar => {
    const card = document.createElement('div');
    card.className = 'mainbareng-card';
    card.innerHTML = `
      <div class="mainbareng-header">
        <div class="mainbareng-title">${mabar.title}</div>
        <div class="mainbareng-creator">
          <img src="${mabar.creatorAvatar}" alt="Pembuat" class="mainbareng-avatar">
          <span>Dibuat oleh: <b>${mabar.creator}</b></span>
        </div>
        <div class="mainbareng-info">
          <div><b>Tanggal:</b> ${mabar.date}</div>
          <div><b>Waktu:</b> ${mabar.time}</div>
          <div><b>Olahraga:</b> ${mabar.sport}</div>
          <div><b>Level:</b> ${mabar.level}</div>
          <div><b>Kuota:</b> ${mabar.slot}</div>
        </div>
        <div class="mainbareng-location">
          <b>Lokasi:</b>
          <div>${mabar.location}</div>
          <a href="${mabar.mapLink}" target="_blank" class="mainbareng-map-link">Lihat di Google Maps</a>
        </div>
      </div>
    `;
    container.appendChild(card);
  });
}

function showMainBarengDetail(id) {
  document.getElementById('mainbarengGrid').style.display = 'none';
  document.getElementById('mainbarengTitle').style.display = 'none';
  document.getElementById('btnShowModal').style.display = 'none';

  const detailContainer = document.getElementById('mainbarengDetailContainer');
  detailContainer.style.display = '';
  detailContainer.innerHTML = '<p>Memuat...</p>';

  fetch(`http://localhost:3000/api/mainbareng/${id}`)
    .then(res => res.json())
    .then(result => {
      if (!result.success) {
        detailContainer.innerHTML = '<p>Event tidak ditemukan.</p>';
        return;
      }
      const item = result.data;
      detailContainer.innerHTML = `
        <div class="mainbareng-detail-layout">
    <div class="mainbareng-detail-main">
      <h1>${item.title}</h1>
      <div style="margin-bottom:18px;">
        <b>${item.sport}</b> &nbsp;‚Ä¢&nbsp; Level: ${item.level}
      </div>
      <section class="mainbareng-detail-section">
        <h3>Tentang Mabar</h3>
        <div class="mainbareng-detail-desc">
          ${item.description ? item.description.replace(/\n/g, '<br>') : '<i>Belum ada deskripsi.</i>'}
        </div>
      </section>
    </div>
    <aside class="mainbareng-detail-aside">
      <div class="mainbareng-card-mabar">
        <h3>Info Event</h3>
        <div class="mainbareng-detail-info">
          <div style="margin-bottom:18px;">
            <b>Sisa Slot</b><br>
            <span>${item.slot_filled || 1}/${item.quota}</span>
          </div>
          <div style="margin-bottom:18px;">
            <b>Metode Pembayaran</b><br>
            <span>${item.payment_method || '-'}</span>
          </div>
          <div style="margin-bottom:18px;">
            <b>Lokasi</b><br>
            <span>${item.location ? item.location.replace(/\n/g, '<br>') : '<i>Belum ada lokasi.</i>'}</span>
          </div>
          <div style="margin-bottom:18px;">
            <b>Waktu & Tanggal</b><br>
            <span>${new Date(item.datetime).toLocaleString('id-ID')}</span>
          </div>
          <div style="margin-bottom:18px;">
            <b>Kuota</b><br>
            <span>${item.quota}</span>
          </div>
          <div style="margin-bottom:18px;">
            <b>Host</b><br>
            <span>${item.host_name || '-'}</span>
          </div>
          <div style="margin-top:28px;">
            <button class="btn-gabung-mabar" onclick="gabungMainBareng(${item.id})" style="width:100%;padding:12px 0;background:#2563eb;color:#fff;font-weight:600;border:none;border-radius:8px;font-size:1.08rem;cursor:pointer;">Gabung Main Bareng</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
      `;
    });
}

function backToMainBarengList() {
  document.getElementById('mainbarengDetailContainer').style.display = 'none';
  document.getElementById('mainbarengGrid').style.display = '';
  document.getElementById('mainbarengTitle').style.display = '';
  document.getElementById('btnShowModal').style.display = 'none';
}

document.getElementById('formCreateMabar').onsubmit = async function(e) {
  e.preventDefault();
  const form = e.target;
  const data = {
    title: form.title.value,
    sport: form.sport.value,
    level: form.level.value,
    datetime: form.datetime.value,
    location: form.location.value,
    quota: form.quota.value,
    paymentMethod: form.paymentMethod.value
  };
  const res = await fetch('http://localhost:3000/api/mainbareng/create', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  });
  const result = await res.json();
  if (result.success) {
    document.getElementById('modalCreateMabar').style.display = 'none';
    fetchAndRenderMainBareng(); // refresh list
  } else {
    alert(result.message || 'Gagal membuat event');
  }
};

  function capitalizeWords(str) {
    return str.replace(/\b\w/g, l => l.toUpperCase());
  }

  // Filter lokasi
  function filterVenues() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    let filtered = venuesData.filter(v => {
      // category filter
      const categoryMatch = activeCategory === 'all' || v.category === activeCategory || v.eventTypes.includes(activeCategory);
      // location filter
      const locationMatch = activeLocation === 'all' || v.location === activeLocation;
      // search filter
      const searchMatch =
        v.title.toLowerCase().includes(searchTerm) ||
        v.location.toLowerCase().includes(searchTerm) ||
        v.description.toLowerCase().includes(searchTerm);
      return categoryMatch && locationMatch && searchMatch;
    });
    return filtered;
  }

  // Set active menu button and update UI
  function setActiveMenu(btn) {
  document.querySelectorAll('.btn-menu').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');

  const isMainBareng = btn.textContent.trim() === 'Main Bareng';
  const searchInput = document.getElementById('searchInput');

  searchInput.placeholder = isMainBareng ? 'Cari Event' : 'Cari Venue';

  if (isMainBareng) {
    lastVenueSearch = searchInput.value;
    searchInput.value = '';
    document.getElementById('venueDetailContainer').innerHTML = '';
  } else {
    searchInput.value = lastVenueSearch;
  }

  const venueSection = document.getElementById('venueSection');
  if (venueSection) venueSection.style.display = isMainBareng ? 'none' : '';
  const mainBarengSection = document.getElementById('mainBarengSection');
  if (mainBarengSection) mainBarengSection.style.display = isMainBareng ? '' : 'none';

  const venuesGrid = document.getElementById('venuesGrid');
  if (venuesGrid) venuesGrid.style.display = isMainBareng ? 'none' : '';
  const paginationNav = document.getElementById('paginationNav');
  if (paginationNav) paginationNav.style.display = isMainBareng ? 'none' : '';
  const mainbarengGrid = document.getElementById('mainbarengGrid');
  if (mainbarengGrid) mainbarengGrid.style.display = isMainBareng ? '' : 'none';
  const mainbarengTitle = document.getElementById('mainbarengTitle');
  if (mainbarengTitle) mainbarengTitle.style.display = isMainBareng ? '' : 'none';

  if (isMainBareng) {
    fetchAndRenderMainBareng();
  } else {
    renderVenues();
  }
}

  let lokasiIndonesia = [];

  // Load regions data for autocomplete
  fetch('regions.json')
    .then(response => response.json())
    .then(data => {
      lokasiIndonesia = [];
      data.forEach(item => {
        item.kota.forEach(kota => {
          lokasiIndonesia.push(`${kota}, ${item.provinsi}`);
      });
    });

      const locationInput = document.getElementById('locationAutocomplete');
      const suggestionsList = document.getElementById('locationSuggestions');

      locationInput.addEventListener('input', function() {
      const keyword = this.value.trim().toLowerCase();
      suggestionsList.innerHTML = '';
        if (!keyword || lokasiIndonesia.length === 0) return;

      let filtered = lokasiIndonesia.filter(l => l.toLowerCase().includes(keyword));
        if (keyword === 'jawa') {
      filtered = lokasiIndonesia.filter(l => l.toLowerCase().includes('jawa')).slice(0, 5);
      } else {
      filtered = filtered.slice(0, 5);
      }

      filtered.forEach(lokasi => {
        const li = document.createElement('li');
        li.textContent = lokasi;
        li.onclick = () => {
        locationInput.value = lokasi;
        suggestionsList.innerHTML = '';
      };
        suggestionsList.appendChild(li);
      });
    });

    // Sembunyikan dropdown jika klik di luar
    document.addEventListener('click', function(event) {
      if (!locationInput.contains(event.target) && !suggestionsList.contains(event.target)) {
        suggestionsList.innerHTML = '';
      }
    });
  });

  // Jadwal lapangan data
  const jadwalLapangan = [
  { start: "07:00", end: "08:00", price: "Rp100.000" },
  { start: "08:00", end: "09:00", price: "Rp100.000" },
  { start: "09:00", end: "10:00", price: "Rp100.000" },
  { start: "10:00", end: "11:00", price: "Rp100.000" },
  { start: "11:00", end: "12:00", price: "Rp100.000" },
  { start: "12:00", end: "13:00", price: "Rp100.000" },
  { start: "13:00", end: "14:00", price: "Rp100.000" },
  { start: "14:00", end: "15:00", price: "Rp100.000" },
  { start: "15:00", end: "16:00", price: "Rp100.000" },
  { start: "16:00", end: "17:00", price: "Rp100.000" },
  { start: "17:00", end: "18:00", price: "Rp100.000" },
  { start: "18:00", end: "19:00", price: "Rp100.000" },
  { start: "19:00", end: "20:00", price: "Rp100.000" },
  { start: "20:00", end: "21:00", price: "Rp100.000" },
  { start: "21:00", end: "22:00", price: "Rp100.000" }
];

  // Render venues with pagination
  function renderVenues() {
    const container = document.getElementById('venuesGrid');
    container.innerHTML = '';

    const filtered = filterVenues();
    const totalVenues = filtered.length;
    const totalPages = Math.ceil(totalVenues / venuesPerPage);

    // Adjust currentPage if out of range
    if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
    if (currentPage < 1) currentPage = 1;

    // Paginate
    const startIndex = (currentPage - 1) * venuesPerPage;
    const paginatedVenues = filtered.slice(startIndex, startIndex + venuesPerPage);

    if (paginatedVenues.length === 0) {
      container.innerHTML = '<p style="grid-column: 1 / -1; text-align:center; color:#888; user-select:none;">Venue tidak ditemukan.</p>';
      renderPagination(totalPages);
      return;
    }

    paginatedVenues.forEach(venue => {
      container.appendChild(createVenueCard(venue));
    });

    renderPagination(totalPages);
  }

  // Render pagination controls
  function renderPagination(totalPages) {
    const pagination = document.getElementById('paginationNav');
    pagination.innerHTML = '';

    if (totalPages <= 1) return;

    // Prev button
    const prevBtn = document.createElement('button');
    prevBtn.textContent = '‚Äπ';
    prevBtn.disabled = currentPage === 1;
    prevBtn.setAttribute('aria-label', 'Previous page');
    prevBtn.onclick = () => {
      if (currentPage > 1) {
        currentPage--;
        renderVenues();
        scrollToTop();
      }
    };
    pagination.appendChild(prevBtn);

    // Page number buttons (show max 5)
    let startPage = 1;
    let endPage = totalPages;
    if (totalPages > 5) {
      if (currentPage <= 3) {
        startPage = 1;
        endPage = 5;
      } else if (currentPage + 2 >= totalPages) {
        startPage = totalPages - 4;
        endPage = totalPages;
      } else {
        startPage = currentPage - 2;
        endPage = currentPage + 2;
      }
    }
    for (let i = startPage; i <= endPage; i++) {
      const pageBtn = document.createElement('button');
      pageBtn.textContent = i.toString();
      pageBtn.className = (i === currentPage) ? 'active' : '';
      pageBtn.setAttribute('aria-label', `Goto page ${i}`);
      pageBtn.onclick = () => {
        currentPage = i;
        renderVenues();
        scrollToTop();
      };
      pagination.appendChild(pageBtn);
    }

    // Next button
    const nextBtn = document.createElement('button');
    nextBtn.textContent = '‚Ä∫';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.setAttribute('aria-label', 'Next page');
    nextBtn.onclick = () => {
      if (currentPage < totalPages) {
        currentPage++;
        renderVenues();
        scrollToTop();
      }
    };
    pagination.appendChild(nextBtn);
  }

  // Scroll to top function
  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  // Set category for filtering
  function setCategory(category) {
    activeCategory = category;
    currentPage = 1;
    // Update buttons active state
    const btns = document.querySelectorAll('nav.categories button');
    btns.forEach(b => b.classList.toggle('active', b.getAttribute('data-category') === category));
    renderVenues();
  }

  // Set location for filtering
  function setLocation(location) {
    activeLocation = location;
    currentPage = 1;
    renderVenues();
  }

  // Event listener for category buttons
  function filterVenuesEvent() {
    const isMainBareng = document.querySelector('.btn-menu.active').textContent.trim() === 'Main Bareng';
    currentPage = 1;

    if (isMainBareng) {
      fetchAndRenderMainBareng();
      return;
    } else {
      renderVenues();
    }
  }

  // Attach event for search enter key
  document.getElementById('searchInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      filterVenuesEvent();
    }
  });

  // Initial render
  renderVenues();
  const mainbarengGrid = document.getElementById('mainbarengGrid');
if (mainbarengGrid) mainbarengGrid.style.display = 'none';

const mainbarengTitle = document.getElementById('mainbarengTitle');
if (mainbarengTitle) mainbarengTitle.style.display = isMainBareng ? '' : 'none';
</script>
</body>
</html>